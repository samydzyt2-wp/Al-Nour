<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù… - Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†ÙˆØ± Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="Ù…Ø¯Ø±Ø³Ø©-Ø§Ù„Ù†Ù€Ù€Ù€Ù€ÙˆØ±-_1_.ico" type="image/x-icon">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { background: #e0f7fa; font-family: 'IBM Plex Sans Arabic', Arial, sans-serif; margin: 0; padding: 0; }
    .navbar { display: flex; justify-content: space-between; align-items: center; padding: 20px 50px; background: #fff; border-bottom: 1px solid #009ca622; }
    .logo-section { display: flex; align-items: center; gap: 15px; }
    .logo-icon { width: 45px; height: 45px; background: #009ca6; color: #fff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; }
    .logo-text h2 { color: #009ca6; font-size: 1.4em; font-weight: 600; margin-bottom: 2px; }
    .logo-text small { color: #009ca6; font-size: 0.8em; font-weight: 300; }
    .main-content { padding: 40px 10px; max-width: 1200px; margin: 0 auto; }
    .table-responsive { width: 100%; overflow-x: auto; }
    table { width: 100%; border-collapse: separate; border-spacing: 0; background: #fff; border-radius: 30px; box-shadow: 0 4px 24px #009ca622; overflow: hidden; min-width: 800px; }
    th, td { padding: 14px 8px; text-align: center; font-size: 1em; }
    th { background: #e0f7fa; color: #009ca6; font-weight: 700; }
    tr:not(:last-child) td { border-bottom: 1px solid #e0f7fa; }
    select, input[type=text] { font-family: inherit; font-size: 1em; border-radius: 8px; border: 1px solid #009ca6; padding: 6px 8px; min-width: 60px; }
    .save-btn { background: #009ca6; color: #fff; border: none; border-radius: 8px; padding: 8px 18px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
    .save-btn:hover { background: #007f8c; }
    .status-present { color: #009c4a; font-weight: bold; }
    .status-absent { color: #e74c3c; font-weight: bold; }
    
    /* ØªØµÙ…ÙŠÙ… Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« */
    .search-container {
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px #009ca622;
      border: 1px solid #009ca615;
    }
    
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .search-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e0f7fa;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #009ca6;
      background: #fff;
      box-shadow: 0 0 0 3px #009ca615;
    }
    
    .search-btn {
      background: #009ca6;
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 50px;
    }
    
    .search-btn:hover {
      background: #007f8c;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px #009ca640;
    }
    
    .search-filters {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .filter-select {
      padding: 8px 12px;
      border: 2px solid #e0f7fa;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9rem;
      background: #f8f9fa;
      color: #009ca6;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    
    .filter-select:focus {
      outline: none;
      border-color: #009ca6;
      background: #fff;
    }
    
    .clear-btn {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-family: inherit;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .clear-btn:hover {
      background: #c0392b;
      transform: translateY(-1px);
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø²Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ */
    .bulk-update-btn {
      background: #27ae60;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-family: inherit;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .bulk-update-btn:hover {
      background: #229954;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px #27ae6040;
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }
    
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 20px 60px rgba(0, 156, 166, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .modal-header {
      background: linear-gradient(135deg, #009ca6, #00b8c4);
      color: #fff;
      padding: 20px 25px;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      margin: 0;
      font-size: 1.3em;
      font-weight: 600;
    }
    
    .close {
      color: #fff;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    
    .close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    
    .modal-body {
      padding: 25px;
    }
    
    .bulk-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-weight: 600;
      color: #009ca6;
      font-size: 0.95em;
    }
    
    .form-control {
      padding: 12px 16px;
      border: 2px solid #e0f7fa;
      border-radius: 10px;
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #009ca6;
      background: #fff;
      box-shadow: 0 0 0 3px #009ca615;
    }
    
    .selected-students {
      max-height: 150px;
      overflow-y: auto;
      border: 2px solid #e0f7fa;
      border-radius: 10px;
      padding: 15px;
      background: #f8f9fa;
    }
    
    .selected-students .student-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      margin-bottom: 8px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #e0f7fa;
      transition: all 0.3s ease;
    }
    
    .selected-students .student-item:hover {
      background: #e0f7fa;
      transform: translateX(-5px);
    }
    
    .selected-students .student-item:last-child {
      margin-bottom: 0;
    }
    
    .remove-student {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .remove-student:hover {
      background: #c0392b;
      transform: scale(1.1);
    }
    
    .modal-footer {
      padding: 20px 25px;
      border-top: 1px solid #e0f7fa;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    
    .save-bulk-btn {
      background: #27ae60;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 24px;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .save-bulk-btn:hover {
      background: #229954;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px #27ae6040;
    }
    
    .save-bulk-btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .cancel-btn {
      background: #95a5a6;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 24px;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .cancel-btn:hover {
      background: #7f8c8d;
      transform: translateY(-2px);
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø§Ù„Ø¨Ø­Ø« */
    .student-row {
      transition: all 0.3s ease;
    }
    
    .student-row.hidden {
      display: none;
    }
    
    .student-row.highlight {
      background: #e0f7fa !important;
      box-shadow: 0 2px 8px #009ca630;
    }
    
    @media (max-width: 900px) {
      .main-content { padding: 10px 2px; }
      table, th, td { font-size: 0.95em; }
      .navbar { padding: 12px 10px; }
      
      .search-container {
        padding: 15px;
        margin-bottom: 20px;
      }
      
      .search-box {
        flex-direction: column;
        gap: 8px;
      }
      
      .search-filters {
        justify-content: center;
        gap: 8px;
      }
      
      .filter-select {
        min-width: 100px;
        font-size: 0.85rem;
      }
    }
    @media (max-width: 600px) {
      .main-content { padding: 6px 1px; }
      .table-responsive { min-width: 0; }
      table { min-width: 480px; border-radius: 16px; }
      th, td { padding: 6px 2px; font-size: 0.85em; }
      .navbar { flex-direction: column; padding: 10px 2vw; }
      .logo-section { gap: 7px; }
      .logo-icon { width: 32px; height: 32px; font-size: 15px; }
      .logo-text h2 { font-size: 1.1em; }
      .logo-text small { font-size: 0.7em; }
      
      .search-container {
        padding: 12px;
        margin-bottom: 15px;
        border-radius: 12px;
      }
      
      .search-input {
        padding: 10px 12px;
        font-size: 0.9rem;
      }
      
      .search-btn {
        padding: 10px 12px;
      }
      
      .search-filters {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }
      
      .filter-select {
        width: 100%;
        min-width: unset;
      }
      
      /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
      .modal-content {
        width: 95%;
        margin: 10% auto;
        border-radius: 15px;
      }
      
      .modal-header {
        padding: 15px 20px;
        border-radius: 15px 15px 0 0;
      }
      
      .modal-header h3 {
        font-size: 1.1em;
      }
      
      .modal-body {
        padding: 20px;
      }
      
      .form-control {
        padding: 10px 12px;
        font-size: 0.9rem;
      }
      
      .modal-footer {
        padding: 15px 20px;
        flex-direction: column;
        gap: 8px;
      }
      
      .save-bulk-btn, .cancel-btn {
        width: 100%;
        padding: 12px;
        font-size: 0.95rem;
      }
      
      .selected-students {
        max-height: 120px;
        padding: 10px;
      }
      
      .selected-students .student-item {
        padding: 6px 10px;
        font-size: 0.9rem;
      }
    }
    h2 { 
      color: #009ca6; 
      text-align: center; 
      margin-bottom: 25px;
      font-size: 1.5em;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    h2 svg {
      transition: transform 0.3s ease;
    }
    
    .admin-box:hover h2 svg {
      transform: scale(1.1);
    }
    
    label { 
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 15px 0 8px; 
      color: #009ca6; 
      font-weight: 500;
      font-size: 0.95em;
    }
    label.table-label {
      display: inline-block;
      color: #009ca6;
      font-weight: 600;
      font-size: 0.97em;
      margin-bottom: 3px;
      letter-spacing: 0.5px;
    }
    .tr-absent td {
        opacity: 0.6;
    }
    .tr-absent td input,
    .tr-absent td select {
      background: #fbe9e7 !important;
      color: #b71c1c !important;
      cursor: not-allowed;
    }
    .tr-absent td label.table-label {
      color: #b71c1c !important;
    }
    .admin-box {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 35px;
      margin: 40px auto;
      max-width: 450px;
      box-shadow: 0 8px 32px rgba(0, 156, 166, 0.15);
      border: 1px solid rgba(0, 156, 166, 0.1);
      transition: all 0.3s ease;
    }

    .admin-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 156, 166, 0.2);
    }
    
    h2 { 
      color: #009ca6; 
      text-align: center; 
      margin-bottom: 25px;
      font-size: 1.5em;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    h2 svg {
      transition: transform 0.3s ease;
    }
    
    .admin-box:hover h2 svg {
      transform: scale(1.1);
    }
    
    label { 
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 15px 0 8px; 
      color: #009ca6; 
      font-weight: 500;
      font-size: 0.95em;
    }

    .admin-box input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0f7fa;
      border-radius: 10px;
      margin-bottom: 15px; 
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }
    
    .admin-box input:focus {
      outline: none;
      border-color: #009ca6;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(0, 156, 166, 0.1);
    }
    
    .admin-box button, .save-btn {
      width: 100%;
      background: linear-gradient(135deg, #009ca6, #00b8c4);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .admin-box button:hover, .save-btn:hover {
      background: linear-gradient(135deg, #007f8c, #009ca6);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 156, 166, 0.3);
    }
    
    .result {
      margin-top: 20px; 
      text-align: center; 
      padding: 10px;
      border-radius: 8px;
      font-weight: 500;
    }
    
    .error { 
      color: #e74c3c; 
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.2);
    }
    
    input[type=number].from-ayah, input[type=number].to-ayah, #bulkFromAyah, #bulkToAyah {
      padding: 6px 8px;
      border: 2px solid #e0f7fa;
      border-radius: 10px;
      font-family: inherit;
      font-size: 0.95em;
      background: #f8f9fa;
      transition: all 0.3s ease;
      box-sizing: border-box;
      text-align: right;
      direction: rtl;
      height: 36px;
      min-width: 60px;
      max-width: 120px;
    }
    input[type=number].from-ayah:focus, input[type=number].to-ayah:focus, #bulkFromAyah:focus, #bulkToAyah:focus {
      outline: none;
      border-color: #009ca6;
      background: #fff;
      box-shadow: 0 0 0 3px #009ca615;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="logo-section">
      <div class="logo-icon">Ù†</div>
      <div class="logo-text">
        <h2>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†ÙˆØ± Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</h2>
        <small>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†ÙˆØ± Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</small>
      </div>
    </div>
    <div><b>ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</b></div>
  </div>
  <div class="main-content">
    <div class="admin-box" id="teacherLoginBox">
      <h2>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
        </svg>
        ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…
      </h2>
      <form id="teacherLoginForm">
        <label for="teacherId">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" fill="currentColor"/>
          </svg>
          Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù„Ù…
        </label>
        <input type="text" id="teacherId" required>
        <label for="teacherPassword">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="currentColor"/>
          </svg>
          ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
        </label>
        <input type="password" id="teacherPassword" required>
        <button type="submit">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z" fill="currentColor"/>
          </svg>
          Ø¯Ø®ÙˆÙ„
        </button>
      </form>
      <div class="result" id="teacherLoginResult"></div>
    </div>
    <div id="teacherPanel" style="display:none;">
      <h2 style="color:#009ca6; text-align:center; margin-bottom:24px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - <span id="fawjTitle"></span></h2>
    
    <!-- Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« -->
      <div class="search-container" id="searchContainer">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±..." class="search-input">
        <button id="searchBtn" class="search-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 21L16.514 16.506L21 21ZM19 10.5C19 15.194 15.194 19 10.5 19C5.806 19 2 15.194 2 10.5C2 5.806 5.806 2 10.5 2C15.194 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="search-filters">
        <select id="statusFilter" class="filter-select">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="Ø­Ø§Ø¶Ø±">Ø­Ø§Ø¶Ø±</option>
          <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨</option>
            <option value="Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
            <option value="Ù„Ù… ÙŠÙØ¹Ø±Ø¶">Ù„Ù… ÙŠÙØ¹Ø±Ø¶</option>
        </select>
        <select id="evaluationFilter" class="filter-select">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
          <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
          <option value="Ø­Ø³Ù†">Ø­Ø³Ù†</option>
          <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
          <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§</option>
        </select>
        <button id="clearFilters" class="clear-btn">Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
        <button id="bulkUpdateBtn" class="bulk-update-btn">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</button>
      </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ -->
    <div id="bulkUpdateModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</h3>
          <span class="close" id="closeBulkModal">&times;</span>
        </div>
        <div class="modal-body">
          <div class="bulk-form">
            <div class="form-group">
              <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
              <select id="bulkStatus" class="form-control">
                <option value="Ø­Ø§Ø¶Ø±">Ø­Ø§Ø¶Ø±</option>
                <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨</option>
                <option value="Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                <option value="Ù„Ù… ÙŠÙØ¹Ø±Ø¶">Ù„Ù… ÙŠÙØ¹Ø±Ø¶</option>
              </select>
            </div>
            <div class="form-group" id="bulkFields">
              <label>Ù…Ù† Ø§Ù„Ø³ÙˆØ±Ø©:</label>
              <select id="bulkFromSurah" class="form-control">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©</option>
              </select>
              <label>Ù…Ù† Ø§Ù„Ø¢ÙŠØ©:</label>
              <input type="number" id="bulkFromAyah" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©">
              <label>Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø©:</label>
              <select id="bulkToSurah" class="form-control">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©</option>
              </select>
              <label>Ø¥Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ©:</label>
              <input type="number" id="bulkToAyah" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©">
              <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</label>
              <select id="bulkEvaluation" class="form-control">
                <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
                <option value="Ø­Ø³Ù†">Ø­Ø³Ù†</option>
                <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
                <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§</option>
              </select>
              <label>Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
              <input type="text" id="bulkNote" class="form-control" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©">
            </div>
            <div class="form-group">
              <label>Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ÙˆÙ†:</label>
              <div id="selectedStudentsList" class="selected-students"></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="saveBulkBtn" class="save-bulk-btn">ØªÙ… Ø§Ù„Ø­ÙØ¸</button>
          <button id="cancelBulkBtn" class="cancel-btn">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
      </div>
    </div>
    
    <div class="table-responsive"><div id="studentsTableContainer"></div></div>
    </div>
  </div>
  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ
    const firebaseConfig = {
    apiKey: "AIzaSyDIxf27yWX291hqbHb7fIcJYOOJCWRTfs8",
    authDomain: "al-nour-1c02e.firebaseapp.com",
    projectId: "al-nour-1c02e",
    storageBucket: "al-nour-1c02e.firebasestorage.app",
    messagingSenderId: "966464739304",
    appId: "1:966464739304:web:85013dbe5584ece1deb65d",
    measurementId: "G-5833RVR669"
  };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ù…ØµÙÙˆÙØ© Ø³ÙˆØ± Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ¹Ø¯Ø¯ Ø¢ÙŠØ§Øª ÙƒÙ„ Ø³ÙˆØ±Ø©
    const surahs = [
      {name: "Ø§Ù„ÙØ§ØªØ­Ø©", ayat: 7}, {name: "Ø§Ù„Ø¨Ù‚Ø±Ø©", ayat: 286}, {name: "Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†", ayat: 200},
      {name: "Ø§Ù„Ù†Ø³Ø§Ø¡", ayat: 176}, {name: "Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©", ayat: 120}, {name: "Ø§Ù„Ø£Ù†Ø¹Ø§Ù…", ayat: 165},
      {name: "Ø§Ù„Ø£Ø¹Ø±Ø§Ù", ayat: 206}, {name: "Ø§Ù„Ø£Ù†ÙØ§Ù„", ayat: 75}, {name: "Ø§Ù„ØªÙˆØ¨Ø©", ayat: 129},
      {name: "ÙŠÙˆÙ†Ø³", ayat: 109}, {name: "Ù‡ÙˆØ¯", ayat: 123}, {name: "ÙŠÙˆØ³Ù", ayat: 111},
      {name: "Ø§Ù„Ø±Ø¹Ø¯", ayat: 43}, {name: "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", ayat: 52}, {name: "Ø§Ù„Ø­Ø¬Ø±", ayat: 99},
      {name: "Ø§Ù„Ù†Ø­Ù„", ayat: 128}, {name: "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡", ayat: 111}, {name: "Ø§Ù„ÙƒÙ‡Ù", ayat: 110},
      {name: "Ù…Ø±ÙŠÙ…", ayat: 98}, {name: "Ø·Ù‡", ayat: 135}, {name: "Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡", ayat: 112},
      {name: "Ø§Ù„Ø­Ø¬", ayat: 78}, {name: "Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†", ayat: 118}, {name: "Ø§Ù„Ù†ÙˆØ±", ayat: 64},
      {name: "Ø§Ù„ÙØ±Ù‚Ø§Ù†", ayat: 77}, {name: "Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡", ayat: 227}, {name: "Ø§Ù„Ù†Ù…Ù„", ayat: 93},
      {name: "Ø§Ù„Ù‚ØµØµ", ayat: 88}, {name: "Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª", ayat: 69}, {name: "Ø§Ù„Ø±ÙˆÙ…", ayat: 60},
      {name: "Ù„Ù‚Ù…Ø§Ù†", ayat: 34}, {name: "Ø§Ù„Ø³Ø¬Ø¯Ø©", ayat: 30}, {name: "Ø§Ù„Ø£Ø­Ø²Ø§Ø¨", ayat: 73},
      {name: "Ø³Ø¨Ø£", ayat: 54}, {name: "ÙØ§Ø·Ø±", ayat: 45}, {name: "ÙŠØ³", ayat: 83},
      {name: "Ø§Ù„ØµØ§ÙØ§Øª", ayat: 182}, {name: "Øµ", ayat: 88}, {name: "Ø§Ù„Ø²Ù…Ø±", ayat: 75},
      {name: "ØºØ§ÙØ±", ayat: 85}, {name: "ÙØµÙ„Øª", ayat: 54}, {name: "Ø§Ù„Ø´ÙˆØ±Ù‰", ayat: 53},
      {name: "Ø§Ù„Ø²Ø®Ø±Ù", ayat: 89}, {name: "Ø§Ù„Ø¯Ø®Ø§Ù†", ayat: 59}, {name: "Ø§Ù„Ø¬Ø§Ø«ÙŠØ©", ayat: 37},
      {name: "Ø§Ù„Ø£Ø­Ù‚Ø§Ù", ayat: 35}, {name: "Ù…Ø­Ù…Ø¯", ayat: 38}, {name: "Ø§Ù„ÙØªØ­", ayat: 29},
      {name: "Ø§Ù„Ø­Ø¬Ø±Ø§Øª", ayat: 18}, {name: "Ù‚", ayat: 45}, {name: "Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª", ayat: 60},
      {name: "Ø§Ù„Ø·ÙˆØ±", ayat: 49}, {name: "Ø§Ù„Ù†Ø¬Ù…", ayat: 62}, {name: "Ø§Ù„Ù‚Ù…Ø±", ayat: 55},
      {name: "Ø§Ù„Ø±Ø­Ù…Ù†", ayat: 78}, {name: "Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©", ayat: 96}, {name: "Ø§Ù„Ø­Ø¯ÙŠØ¯", ayat: 29},
      {name: "Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©", ayat: 22}, {name: "Ø§Ù„Ø­Ø´Ø±", ayat: 24}, {name: "Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©", ayat: 13},
      {name: "Ø§Ù„ØµÙ", ayat: 14}, {name: "Ø§Ù„Ø¬Ù…Ø¹Ø©", ayat: 11}, {name: "Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†", ayat: 11},
      {name: "Ø§Ù„ØªØºØ§Ø¨Ù†", ayat: 18}, {name: "Ø§Ù„Ø·Ù„Ø§Ù‚", ayat: 12}, {name: "Ø§Ù„ØªØ­Ø±ÙŠÙ…", ayat: 12},
      {name: "Ø§Ù„Ù…Ù„Ùƒ", ayat: 30}, {name: "Ø§Ù„Ù‚Ù„Ù…", ayat: 52}, {name: "Ø§Ù„Ø­Ø§Ù‚Ø©", ayat: 52},
      {name: "Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬", ayat: 44}, {name: "Ù†ÙˆØ­", ayat: 28}, {name: "Ø§Ù„Ø¬Ù†", ayat: 28},
      {name: "Ø§Ù„Ù…Ø²Ù…Ù„", ayat: 20}, {name: "Ø§Ù„Ù…Ø¯Ø«Ø±", ayat: 56}, {name: "Ø§Ù„Ù‚ÙŠØ§Ù…Ø©", ayat: 40},
      {name: "Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", ayat: 31}, {name: "Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª", ayat: 50}, {name: "Ø§Ù„Ù†Ø¨Ø£", ayat: 40},
      {name: "Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª", ayat: 46}, {name: "Ø¹Ø¨Ø³", ayat: 42}, {name: "Ø§Ù„ØªÙƒÙˆÙŠØ±", ayat: 29},
      {name: "Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±", ayat: 19}, {name: "Ø§Ù„Ù…Ø·ÙÙÙŠÙ†", ayat: 36}, {name: "Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚", ayat: 25},
      {name: "Ø§Ù„Ø¨Ø±ÙˆØ¬", ayat: 22}, {name: "Ø§Ù„Ø·Ø§Ø±Ù‚", ayat: 17}, {name: "Ø§Ù„Ø£Ø¹Ù„Ù‰", ayat: 19},
      {name: "Ø§Ù„ØºØ§Ø´ÙŠØ©", ayat: 26}, {name: "Ø§Ù„ÙØ¬Ø±", ayat: 30}, {name: "Ø§Ù„Ø¨Ù„Ø¯", ayat: 20},
      {name: "Ø§Ù„Ø´Ù…Ø³", ayat: 15}, {name: "Ø§Ù„Ù„ÙŠÙ„", ayat: 21}, {name: "Ø§Ù„Ø¶Ø­Ù‰", ayat: 11},
      {name: "Ø§Ù„Ø´Ø±Ø­", ayat: 8}, {name: "Ø§Ù„ØªÙŠÙ†", ayat: 8}, {name: "Ø§Ù„Ø¹Ù„Ù‚", ayat: 19},
      {name: "Ø§Ù„Ù‚Ø¯Ø±", ayat: 5}, {name: "Ø§Ù„Ø¨ÙŠÙ†Ø©", ayat: 8}, {name: "Ø§Ù„Ø²Ù„Ø²Ù„Ø©", ayat: 8},
      {name: "Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª", ayat: 11}, {name: "Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©", ayat: 11}, {name: "Ø§Ù„ØªÙƒØ§Ø«Ø±", ayat: 8},
      {name: "Ø§Ù„Ø¹ØµØ±", ayat: 3}, {name: "Ø§Ù„Ù‡Ù…Ø²Ø©", ayat: 9}, {name: "Ø§Ù„ÙÙŠÙ„", ayat: 5},
      {name: "Ù‚Ø±ÙŠØ´", ayat: 4}, {name: "Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†", ayat: 7}, {name: "Ø§Ù„ÙƒÙˆØ«Ø±", ayat: 3},
      {name: "Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†", ayat: 6}, {name: "Ø§Ù„Ù†ØµØ±", ayat: 3}, {name: "Ø§Ù„Ù…Ø³Ø¯", ayat: 5},
      {name: "Ø§Ù„Ø¥Ø®Ù„Ø§Øµ", ayat: 4}, {name: "Ø§Ù„ÙÙ„Ù‚", ayat: 5}, {name: "Ø§Ù„Ù†Ø§Ø³", ayat: 6}
    ];

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† (Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯)
    const TEACHERS = [
      { id: '1001', password: '2222', fawj: 'ÙÙˆØ¬ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ø³Ø§Ù…Ø©' },
      { id: '1002', password: '5555', fawj: 'ÙÙˆØ¬ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø­Ù…ÙˆØ¯Ø©' },
      { id: '1003', password: '9999', fawj: 'ÙÙˆØ¬ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø´ÙŠØ±' },
      { id: '1004', password: '1956', fawj: 'ÙÙˆØ¬ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø¬' }
    ];

    let currentFawj = null;

    // Ø´Ø§Ø´Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…
    document.getElementById('teacherLoginForm').onsubmit = function(e) {
      e.preventDefault();
      const id = document.getElementById('teacherId').value.trim();
      const password = document.getElementById('teacherPassword').value.trim();
      const teacher = TEACHERS.find(t => t.id === id && t.password === password);
      if (teacher) {
        currentFawj = teacher.fawj;
        document.getElementById('teacherLoginBox').style.display = 'none';
        document.getElementById('teacherPanel').style.display = 'block';
        document.getElementById('fawjTitle').textContent = currentFawj;
        loadStudents();
      } else {
        document.getElementById('teacherLoginResult').textContent = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
        document.getElementById('teacherLoginResult').className = 'result error';
      }
    };

    // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ¹Ø±Ø¶Ù‡Ù… Ø­Ø³Ø¨ Ø§Ù„ÙÙˆØ¬
    async function loadStudents() {
      const studentsSnap = await db.collection('students').where('fawj', '==', currentFawj).get();
      const students = studentsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      window.allStudents = students; // Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ù„Ø¨Ø­Ø«
      renderTable(students);
      setupSearchAndFilters();
    }

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function renderTable(students) {
      let html = `<table><thead><tr>
        <th>Ø±Ù‚Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ°</th>
        <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø¨Ù†</th>
        <th>Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ù…Ù† Ø§Ù„Ø³ÙˆØ±Ø©</th>
        <th>Ù…Ù† Ø§Ù„Ø¢ÙŠØ©</th>
        <th>Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø©</th>
        <th>Ø¥Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ©</th>
        <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
        <th>Ø­ÙØ¸</th>
      </tr></thead><tbody>`;
      students.forEach((student, idx) => {
        html += `<tr data-idx="${idx}" data-id="${student.id}" class="student-row">
          <td>${student.id}</td>
          <td>${student.studentName || ''}</td>
          <td>${student.parentName || ''}</td>
          <td>
            <label class="table-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select class="status-select">
              <option value="Ø­Ø§Ø¶Ø±" class="present">Ø­Ø§Ø¶Ø±</option>
              <option value="ØºØ§Ø¦Ø¨" class="absent">ØºØ§Ø¦Ø¨</option>
              <option value="Ù…Ø±Ø§Ø¬Ø¹Ø©" class="present">Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
              <option value="Ù„Ù… ÙŠÙØ¹Ø±Ø¶" class="absent">Ù„Ù… ÙŠÙØ¹Ø±Ø¶</option>
            </select>
          </td>
          <td>
            <label class="table-label">Ù…Ù† Ø§Ù„Ø³ÙˆØ±Ø©</label>
            <select class="from-surah">${surahs.map((s,i)=>`<option value="${s.name}">${s.name}</option>`).join('')}</select>
          </td>
          <td>
            <label class="table-label">Ù…Ù† Ø§Ù„Ø¢ÙŠØ©</label>
            <input type="number" class="from-ayah" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©">
          </td>
          <td>
            <label class="table-label">Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø©</label>
            <select class="to-surah">${surahs.map((s,i)=>`<option value="${s.name}">${s.name}</option>`).join('')}</select>
          </td>
          <td>
            <label class="table-label">Ø¥Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ©</label>
            <input type="number" class="to-ayah" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©">
          </td>
          <td>
            <label class="table-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</label>
            <select class="eval-select">
              <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
              <option value="Ø­Ø³Ù†">Ø­Ø³Ù†</option>
              <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
              <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§</option>
            </select>
          </td>
          <td>
            <label class="table-label">Ù…Ù„Ø§Ø­Ø¸Ø©</label>
            <input type="text" class="note-input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©">
          </td>
          <td><button class="save-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-left: 8px;"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>
            Ø­ÙØ¸
          </button></td>
        </tr>`;
      });
      html += '</tbody></table>';
      document.getElementById('studentsTableContainer').innerHTML = html;
      // ØªÙ‡ÙŠØ¦Ø© Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¢ÙŠØ§Øª
      document.querySelectorAll('tr[data-idx]').forEach(tr => {
        const fromSurahSel = tr.querySelector('.from-surah');
        const fromAyahSel = tr.querySelector('.from-ayah');
        const toSurahSel = tr.querySelector('.to-surah');
        const toAyahSel = tr.querySelector('.to-ayah');
        const statusSelect = tr.querySelector('.status-select');
        const evalSelect = tr.querySelector('.eval-select');
        const noteInput = tr.querySelector('.note-input');
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
        function toggleFieldsByStatus() {
          const isAbsent = statusSelect.value === 'ØºØ§Ø¦Ø¨' || statusSelect.value === 'Ù„Ù… ÙŠÙØ¹Ø±Ø¶';
          const fieldsToDisable = [
            fromSurahSel, fromAyahSel, toSurahSel, toAyahSel,
            tr.querySelector('.eval-select'),
            tr.querySelector('.note-input')
          ];
          
          if (isAbsent) {
            tr.classList.add('tr-absent');
            fieldsToDisable.forEach(field => {
                if (field) field.disabled = true;
            });
          } else {
            tr.classList.remove('tr-absent');
            fieldsToDisable.forEach(field => {
                if (field) field.disabled = false;
            });
          }
          // Change class for status color
          statusSelect.className = 'status-select ' + (isAbsent ? 'absent' : 'present');
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
        statusSelect.addEventListener('change', toggleFieldsByStatus);
        
        // Ø¯ÙˆØ§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ±Ø©
        function updateAyat(selSurah, ayahSel) {
          const surahIdx = surahs.findIndex(s => s.name === selSurah.value);
          const ayatCount = surahIdx >= 0 ? surahs[surahIdx].ayat : 1;
          ayahSel.innerHTML = Array.from({length: ayatCount}, (_,i)=>`<option value="${i+1}">${i+1}</option>`).join('');
        }
        fromSurahSel.addEventListener('change', ()=>updateAyat(fromSurahSel, fromAyahSel));
        toSurahSel.addEventListener('change', ()=>updateAyat(toSurahSel, toAyahSel));
        // ØªÙ‡ÙŠØ¦Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        updateAyat(fromSurahSel, fromAyahSel);
        updateAyat(toSurahSel, toAyahSel);
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        toggleFieldsByStatus();
      });
      // Ø²Ø± Ø§Ù„Ø­ÙØ¸
      document.querySelectorAll('.save-btn').forEach((btn, idx) => {
        btn.addEventListener('click', async function() {
          const tr = btn.closest('tr');
          const studentId = tr.getAttribute('data-id');
          const status = tr.querySelector('.status-select').value;
          const isAbsent = status === 'ØºØ§Ø¦Ø¨' || status === 'Ù„Ù… ÙŠÙØ¹Ø±Ø¶';
          
          // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
          const data = {
            studentId,
            date: new Date().toISOString().slice(0,10),
            status
          };
          
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø­Ø§Ø¶Ø±
          if (!isAbsent) {
            data.fromSurah = tr.querySelector('.from-surah').value;
            data.fromAyah = parseInt(tr.querySelector('.from-ayah').value);
            data.toSurah = tr.querySelector('.to-surah').value;
            data.toAyah = parseInt(tr.querySelector('.to-ayah').value);
            data.evaluation = tr.querySelector('.eval-select').value;
            data.note = tr.querySelector('.note-input').value;
          }
          
          try {
            await db.collection('attendance').add(data);
            btn.textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸';
            btn.style.background = '#009c4a';
            setTimeout(()=>{ 
              btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-left: 8px;"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> Ø­ÙØ¸`; 
              btn.style.background = ''; 
            }, 2000);
          } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', error);
            btn.textContent = 'Ø®Ø·Ø£';
            btn.style.background = '#e74c3c';
            setTimeout(()=>{ 
              btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-left: 8px;"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> Ø­ÙØ¸`; 
              btn.style.background = ''; 
            }, 2000);
          }
        });
      });
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±
    function setupSearchAndFilters() {
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');
      const statusFilter = document.getElementById('statusFilter');
      const evaluationFilter = document.getElementById('evaluationFilter');
      const clearFilters = document.getElementById('clearFilters');

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
      searchInput.addEventListener('input', performSearch);
      searchBtn.addEventListener('click', performSearch);
      
      // Ø§Ù„ÙÙ„Ø§ØªØ±
      statusFilter.addEventListener('change', performSearch);
      evaluationFilter.addEventListener('change', performSearch);
      
      // Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
      clearFilters.addEventListener('click', () => {
        searchInput.value = '';
        statusFilter.value = '';
        evaluationFilter.value = '';
        performSearch();
      });
    }

    // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©
    function performSearch() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value;
      const evaluationFilter = document.getElementById('evaluationFilter').value;
      
      const rows = document.querySelectorAll('tr[data-idx]');
      
      rows.forEach(row => {
        const studentName = row.cells[1].textContent.toLowerCase();
        const parentName = row.cells[2].textContent.toLowerCase();
        const status = row.querySelector('.status-select')?.value || '';
        const evaluation = row.querySelector('.eval-select')?.value || '';
        
        let showRow = true;
        
        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù†Øµ
        if (searchTerm && !studentName.includes(searchTerm) && !parentName.includes(searchTerm)) {
          showRow = false;
        }
        
        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
        if (statusFilter && status !== statusFilter) {
          showRow = false;
        }
        
        // ÙÙ„ØªØ±Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        if (evaluationFilter && evaluation !== evaluationFilter) {
          showRow = false;
        }
        
        if (showRow) {
          row.classList.remove('hidden');
          if (searchTerm && (studentName.includes(searchTerm) || parentName.includes(searchTerm))) {
            row.classList.add('highlight');
          } else {
            row.classList.remove('highlight');
          }
        } else {
          row.classList.add('hidden');
          row.classList.remove('highlight');
        }
      });
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬
      showNoResultsMessage();
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†ØªØ§Ø¦Ø¬
    function showNoResultsMessage() {
      const visibleRows = document.querySelectorAll('tr[data-idx]:not(.hidden)');
      const noResultsMsg = document.getElementById('noResultsMessage');
      const container = document.getElementById('studentsTableContainer');
      
      if (visibleRows.length === 0) {
        if (!noResultsMsg) {
          const msg = document.createElement('div');
          msg.id = 'noResultsMessage';
          // Make it span all columns if table is empty
          if(container.querySelector('table')) {
              const colCount = container.querySelector('table thead th').length;
              msg.innerHTML = `<td colspan="${colCount}">...</td>` // to be replaced by full msg
          }
          msg.innerHTML = `
            <div style="padding: 40px;">
            <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ”</div>
            <div>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</div>
            <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.7;">Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„Ø§ØªØ±</div>
            </div>
          `;
          container.appendChild(msg);
        }
      } else {
        if (noResultsMsg) {
          noResultsMsg.remove();
        }
      }
    }

    // Ù„Ø§ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
    let selectedStudents = [];
    let bulkUpdateModal = null;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
    function setupBulkUpdate() {
      bulkUpdateModal = document.getElementById('bulkUpdateModal');
      const bulkUpdateBtn = document.getElementById('bulkUpdateBtn');
      const closeBulkModal = document.getElementById('closeBulkModal');
      const cancelBulkBtn = document.getElementById('cancelBulkBtn');
      const saveBulkBtn = document.getElementById('saveBulkBtn');
      const bulkStatus = document.getElementById('bulkStatus');
      const bulkFromSurah = document.getElementById('bulkFromSurah');
      const bulkToSurah = document.getElementById('bulkToSurah');
      
      // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³ÙˆØ±
      bulkFromSurah.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©</option>' + 
        surahs.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
      bulkToSurah.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©</option>' + 
        surahs.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
      
      // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
      bulkUpdateBtn.addEventListener('click', openBulkUpdateModal);
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
      closeBulkModal.addEventListener('click', closeBulkUpdateModal);
      cancelBulkBtn.addEventListener('click', closeBulkUpdateModal);
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
      bulkUpdateModal.addEventListener('click', function(e) {
        if (e.target === bulkUpdateModal) {
          closeBulkUpdateModal();
        }
      });
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
      bulkStatus.addEventListener('change', toggleBulkFields);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢ÙŠØ§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø³ÙˆØ±
      bulkFromSurah.addEventListener('change', () => updateBulkAyat('from'));
      bulkToSurah.addEventListener('change', () => updateBulkAyat('to'));
      
      // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©
      saveBulkBtn.addEventListener('click', saveBulkData);
      
      // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
      toggleBulkFields();
    }
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
    function openBulkUpdateModal() {
      // ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠÙŠÙ† (ØºÙŠØ± Ø§Ù„Ù…Ø®ÙÙŠÙŠÙ†)
      const visibleRows = document.querySelectorAll('tr[data-idx]:not(.hidden)');
      selectedStudents = [];
      
      visibleRows.forEach(row => {
        const studentId = row.getAttribute('data-id');
        const studentName = row.cells[1].textContent;
        const parentName = row.cells[2].textContent;
        
        selectedStudents.push({
          id: studentId,
          name: studentName,
          parentName: parentName
        });
      });
      
      if (selectedStudents.length === 0) {
        alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø© Ù…Ø­Ø¯Ø¯ÙŠÙ† Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ');
        return;
      }
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†
      displaySelectedStudents();
      
      // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
      bulkUpdateModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
    function closeBulkUpdateModal() {
      bulkUpdateModal.style.display = 'none';
      document.body.style.overflow = 'auto';
      selectedStudents = [];
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†
    function displaySelectedStudents() {
      const container = document.getElementById('selectedStudentsList');
      container.innerHTML = '';
      
      selectedStudents.forEach(student => {
        const studentItem = document.createElement('div');
        studentItem.className = 'student-item';
        studentItem.innerHTML = `
          <span>${student.name} - ${student.parentName}</span>
          <button class="remove-student" onclick="removeStudent('${student.id}')">&times;</button>
        `;
        container.appendChild(studentItem);
      });
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    function removeStudent(studentId) {
      selectedStudents = selectedStudents.filter(s => s.id !== studentId);
      displaySelectedStudents();
    }
    
    // Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
    function toggleBulkFields() {
      const bulkStatus = document.getElementById('bulkStatus');
      const bulkFields = document.getElementById('bulkFields');
      const isAbsent = bulkStatus.value === 'ØºØ§Ø¦Ø¨' || bulkStatus.value === 'Ù„Ù… ÙŠÙØ¹Ø±Ø¶';
      
      if (isAbsent) {
        bulkFields.style.display = 'none';
      } else {
        bulkFields.style.display = 'block';
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¢ÙŠØ§Øª
    function updateBulkAyat(type) {
      const surahSelect = type === 'from' ? document.getElementById('bulkFromSurah') : document.getElementById('bulkToSurah');
      const ayahSelect = type === 'from' ? document.getElementById('bulkFromAyah') : document.getElementById('bulkToAyah');
      
      const surahName = surahSelect.value;
      if (!surahName) {
        ayahSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¢ÙŠØ©</option>';
        return;
      }
      
      const surahIdx = surahs.findIndex(s => s.name === surahName);
      const ayatCount = surahIdx >= 0 ? surahs[surahIdx].ayat : 1;
      
      ayahSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¢ÙŠØ©</option>' + 
        Array.from({length: ayatCount}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join('');
    }
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©
    async function saveBulkData() {
      if (selectedStudents.length === 0) {
        alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø© Ù…Ø­Ø¯Ø¯ÙŠÙ†');
        return;
      }
      
      const saveBtn = document.getElementById('saveBulkBtn');
      const originalText = saveBtn.textContent;
      
      try {
        saveBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        saveBtn.disabled = true;
        
        const bulkStatus = document.getElementById('bulkStatus').value;
        const isAbsent = bulkStatus === 'ØºØ§Ø¦Ø¨' || bulkStatus === 'Ù„Ù… ÙŠÙØ¹Ø±Ø¶';
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const baseData = {
          date: new Date().toISOString().slice(0, 10),
          status: bulkStatus
        };
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† ØºØ§Ø¦Ø¨
        if (!isAbsent) {
          baseData.fromSurah = document.getElementById('bulkFromSurah').value;
          baseData.fromAyah = parseInt(document.getElementById('bulkFromAyah').value);
          baseData.toSurah = document.getElementById('bulkToSurah').value;
          baseData.toAyah = parseInt(document.getElementById('bulkToAyah').value);
          baseData.evaluation = document.getElementById('bulkEvaluation').value;
          baseData.note = document.getElementById('bulkNote').value;
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†
        const savePromises = selectedStudents.map(student => {
          const data = {
            ...baseData,
            studentId: student.id
          };
          return db.collection('attendance').add(data);
        });
        
        await Promise.all(savePromises);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
        updateTableAfterBulkSave();
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        saveBtn.textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!';
        saveBtn.style.background = '#27ae60';
        
        setTimeout(() => {
          closeBulkUpdateModal();
          saveBtn.textContent = originalText;
          saveBtn.disabled = false;
          saveBtn.style.background = '';
        }, 2000);
        
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ:', error);
        saveBtn.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸';
        saveBtn.style.background = '#e74c3c';
        
        setTimeout(() => {
          saveBtn.textContent = originalText;
          saveBtn.disabled = false;
          saveBtn.style.background = '';
        }, 2000);
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
    function updateTableAfterBulkSave() {
      const bulkStatus = document.getElementById('bulkStatus').value;
      const isAbsent = bulkStatus === 'ØºØ§Ø¦Ø¨' || bulkStatus === 'Ù„Ù… ÙŠÙØ¹Ø±Ø¶';
      
      selectedStudents.forEach(student => {
        const row = document.querySelector(`tr[data-id="${student.id}"]`);
        if (row) {
          const statusSelect = row.querySelector('.status-select');
          const fromSurahSelect = row.querySelector('.from-surah');
          const fromAyahSelect = row.querySelector('.from-ayah');
          const toSurahSelect = row.querySelector('.to-surah');
          const toAyahSelect = row.querySelector('.to-ayah');
          const evalSelect = row.querySelector('.eval-select');
          const noteInput = row.querySelector('.note-input');
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
          statusSelect.value = bulkStatus;
          
          if (!isAbsent) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰
            fromSurahSelect.value = document.getElementById('bulkFromSurah').value;
            fromAyahSelect.value = document.getElementById('bulkFromAyah').value;
            toSurahSelect.value = document.getElementById('bulkToSurah').value;
            toAyahSelect.value = document.getElementById('bulkToAyah').value;
            evalSelect.value = document.getElementById('bulkEvaluation').value;
            noteInput.value = document.getElementById('bulkNote').value;
          }
          
          // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
          statusSelect.dispatchEvent(new Event('change'));
          
          // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­ÙØ¸
          const saveBtn = row.querySelector('.save-btn');
          saveBtn.textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸';
          saveBtn.style.background = '#009c4a';
          
          setTimeout(() => {
            saveBtn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-left: 8px;"><path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg> Ø­ÙØ¸`;
            saveBtn.style.background = '';
          }, 2000);
        }
      });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© loadStudents Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
    const originalLoadStudents = loadStudents;
    loadStudents = async function() {
      await originalLoadStudents();
      setupBulkUpdate();
    };
  </script>
</body>
</html> 